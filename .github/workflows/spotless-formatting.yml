name: Spotless Code Formatting

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to apply formatting to'
        required: false
        default: 'main'
        type: string

jobs:
  format:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.branch || github.ref }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'
          cache: 'maven'

      - name: Run Spotless apply
        run: mvn spotless:apply -B

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Apply Spotless formatting"
          title: "Apply Spotless code formatting"
          body: |
            This PR applies Spotless code formatting to ensure all code follows the Google Java style guide.
            
            Changes were automatically generated by running `mvn spotless:apply`.
          branch: spotless-formatting-${{ github.run_number }}
          delete-branch: true
          labels: automated, formatting
